{% extends "base.html" %}
{% block content %}
<section class="space-y-6">
  <div class="flex flex-wrap items-center justify-between gap-3">
    <div>
      <p class="text-sm uppercase tracking-[0.2em] text-cyan-300">Журналы</p>
      <h1 class="text-2xl md:text-3xl font-bold">Успеваемость группы</h1>
    </div>
    <a href="/teacher_profile/" class="text-sm px-4 py-2 rounded-lg border border-slate-700 hover:border-cyan-400 transition">Назад в профиль</a>
  </div>

  <div id="journal-table" class="table-surface overflow-x-auto">
    <table class="min-w-full table-auto border-collapse">
      <thead>
        <tr>
          <th class="px-4 py-3 text-left border-b">Студент</th>
          <th class="px-4 py-3 text-left border-b">Группа</th>
          <th class="px-4 py-3 text-left border-b">Дата</th>
          <th class="px-4 py-3 text-left border-b">Оценка</th>
          <th class="px-4 py-3 text-left border-b">Комментарий</th>
        </tr>
      </thead>
      <tbody id="journal-body" class="divide-y divide-slate-800">
        <tr><td class="px-4 py-3 text-slate-300" colspan="5">Загрузка...</td></tr>
      </tbody>
    </table>
  </div>
</section>

<script>
  const tbody = document.getElementById('journal-body');
  const pathParts = location.pathname.split('/').filter(Boolean);
  const teacherId = Number(pathParts[pathParts.length - 2]) || null;

  function renderRows(list){
    if (!list.length) {
      tbody.innerHTML = `<tr><td class="px-4 py-3 text-slate-300" colspan="5">Пусто</td></tr>`;
      return;
    }
    tbody.innerHTML = list.map(item => `
      <tr>
        <td class="px-4 py-3">${item.student}</td>
        <td class="px-4 py-3">${item.group}</td>
        <td class="px-4 py-3">${item.date}</td>
        <td class="px-4 py-3">${item.grade || '—'}</td>
        <td class="px-4 py-3">${item.comment || '—'}</td>
      </tr>
    `).join('');
  }

  async function loadJournal() {
    try {
      const resp = await fetch('/api/journal/');
      if(!resp.ok) throw new Error('Не удалось загрузить журнал');
      const data = await resp.json();
      const filtered = teacherId ? data.filter(r => r.group_teacher_id === teacherId) : data;
      renderRows(filtered);
    } catch (e) {
      tbody.innerHTML = `<tr><td class="px-4 py-3 text-red-300" colspan="5">${e.message}</td></tr>`;
    }
  }

  loadJournal();
</script>
{% endblock %}

